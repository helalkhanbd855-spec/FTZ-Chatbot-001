<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FTZ Chatbot 2</title>
  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./assets/favicon.png" />
  <style>
    :root{--bg:#0b1220;--surface:#0f172a;--text:#e5e7eb;--muted:#94a3b8;--primary:#0A84FF;--primaryText:#00112a}
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b1220,#0a0f1c);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial}
    header{display:flex;align-items:center;gap:12px;padding:16px 20px;border-bottom:1px solid #15213a;background:linear-gradient(90deg,var(--surface),#0b1220)}
    header img{width:40px;height:40px;border-radius:10px;background:white;padding:2px}
    header h1{font-size:18px;margin:0}
    main{max-width:960px;margin:0 auto;padding:20px;display:flex;flex-direction:column;gap:16px}
    .hero{background:radial-gradient(1000px 300px at 50% -20%, #0A84FF22, transparent), var(--surface);border:1px solid #1f2a44;border-radius:20px;padding:24px;box-shadow:0 10px 40px rgba(0,0,0,.35)}
    #answer{min-height:56px;font-size:22px;line-height:1.5}
    #loading{display:none;color:#facc15;font-style:italic}
    .ask{display:flex;gap:10px;align-items:center;background:linear-gradient(180deg,#0d1b34,#0a1327);border:1px solid #1f2a44;border-radius:16px;padding:12px 12px;box-shadow:0 8px 28px rgba(0,0,0,.30)}
    .ask input[type="text"]{flex:1;padding:12px 14px;border-radius:12px;border:1px solid #223352;background:#0a1429;color:var(--text);outline:none}
    .ask button{padding:12px 18px;border:none;border-radius:12px;background:var(--primary);color:white;font-weight:700;cursor:pointer;transition:transform .05s ease}
    .ask button:active{transform:translateY(1px)}
    .quick{display:flex;flex-wrap:wrap;gap:10px}
    .chip{background:#0b162e;border:1px solid #223352;color:var(--muted);padding:8px 12px;border-radius:999px;font-size:13px;cursor:pointer}
    .muted{color:var(--muted);font-size:12px}
  </style>
  <script>
    window.API_BASE = window.API_BASE || localStorage.getItem('API_BASE') || 'http://127.0.0.1:5000';
  </script>
</head>
<body>
  <header>
    <img src="./assets/icon-192.png" alt="FTZ">
    <h1>FTZ Chatbot 2</h1>
  </header>

  <main>
    <div class="hero">
      <div id="answer">How can I help you?</div>
      <div id="loading">⏳ Bot is thinking…</div>
    </div>

    <div class="ask">
      <input id="user-input" type="text" placeholder="Ask me anything…" />
      <button id="sendBtn">Send</button>
    </div>

    <div class="quick">
      <div class="chip" onclick="setQuick('Create timecard for today')">Create timecard</div>
      <div class="chip" onclick="setQuick('Update timecard: 9am-5pm')">Update timecard</div>
      <div class="chip" onclick="setQuick('Show my timecard summary')">See timecard</div>
      <div class="chip" onclick="setQuick('Create an image of FTZ logo with blue theme')">Create image</div>
    </div>

    <div class="muted">Tip: On mobile, “Add to Home Screen” to install the app.</div>
  </main>

  <script>
    function setQuick(text){document.getElementById('user-input').value = text;document.getElementById('user-input').focus();}
    function typeEffect(el, text, speed=18){el.textContent='';let i=0;(function t(){if(i<text.length){el.textContent+=text.charAt(i++);setTimeout(t,speed);}})();}
    async function sendMessage() {
      const input = document.getElementById('user-input');
      const btn = document.getElementById('sendBtn');
      const answer = document.getElementById('answer');
      const loading = document.getElementById('loading');
      const msg = input.value.trim();
      if(!msg) return;
      btn.disabled = true; loading.style.display='block'; answer.textContent='';
      try {
        const res = await fetch(`${window.API_BASE}/chat`, {
          method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({message:msg})
        });
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        loading.style.display='none';
        typeEffect(answer, data.reply || 'No response.');
      } catch(e) {
        console.error(e); loading.style.display='none'; answer.textContent='⚠️ Error: Could not connect to chatbot.';
      } finally {
        btn.disabled = false; input.value=''; input.focus();
      }
    }
    document.getElementById('sendBtn').addEventListener('click', sendMessage);
    document.getElementById('user-input').addEventListener('keydown', e => { if(e.key==='Enter') sendMessage(); });
    if('serviceWorker' in navigator) { navigator.serviceWorker.register('./sw.js').catch(()=>{}); }
    const urlParams = new URLSearchParams(location.search); const api=urlParams.get('api'); if(api){ localStorage.setItem('API_BASE',api); window.API_BASE=api; }
  </script>
</body>
</html>
